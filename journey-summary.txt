# TinyTickets â€” Journey Summary (Minimalistic)

## ğŸ¯ Goal
Create a tiny full-stack app using Angular + .NET + SQL + Docker to master real-world DevOps fundamentals.

---

## ğŸ§© Key Problems We Encountered

### 1. Visual Studio API launch issues  
IIS Express failed â€” switched to Kestrel profiles â†’ fixed.

### 2. Folder mismatch & Dockerfile COPY failures  
Renamed folder still showed "WebApplication1".  
Fixed structure â†’ corrected Dockerfile paths.

### 3. Angular container only showed Nginx homepage  
Angular v17+ changed dist path.  
Corrected to: `dist/web/browser`.

### 4. Persistent CORS errors  
Not a CORS issue â€” API was crashing.  
Root cause: SQL login failure.

### 5. SQL Server â€œLogin failed for user 'sa'â€  
Database did not exist inside container.  
Solution: automatic EF Core migrations on startup.

### 6. EF tools missing inside container  
Image used only runtime â€” no SDK.  
Solved by removing need for EF tools entirely.

---

## ğŸš€ Final Working Architecture

- Angular served via Nginx  
- .NET API running in container on port 8080  
- SQL Server (db) container accessed as `Server=db,1433`  
- Automatic migrations create DB + tables  
- Angular talks to API @ `http://localhost:5080/tickets`  
- Everything wired through `docker-compose.yml`

---

## ğŸ‰ Outcome
A clean, production-inspired containerized full-stack environment:

âœ” Angular â†’ API â†’ SQL communication  
âœ” Zero CORS issues  
âœ” Auto DB creation  
âœ” Stable Docker builds  
âœ” All components running together smoothly  

You now fully understand **Docker networking, containerized APIs, SQL hosting, Angular dist deployment, and CORS logic**.

=========================================================================================================================
===============================================Azure Only Journey========================================================
=========================================================================================================================

ğŸŒ©ï¸ TinyTickets â€” Azure Journey Log (Minimalistic & Chronological)
ğŸ¯ Purpose

Document every Azure-related step, issue, and fix we performed from Level 4 â†’ start of Level 5.

1ï¸âƒ£ Initial Azure Goal

Deploy the Angular frontend + .NET backend + DB to Azure:

Angular â†’ Azure Static Web Apps

API â†’ Azure App Service

DB â†’ Azure SQL

CI/CD â†’ GitHub Actions

2ï¸âƒ£ Azure SQL Setup
âœ“ Actions Performed

Created Azure SQL server & database.

Configured firewall rules:

Allowed Azure services

Added local IP for initial migration test

Generated connection string.

ğŸ”§ Roadblocks

EF Core migrations not applied to Azure SQL
â†’ Solved by running API locally with the Azure SQL connection string, allowing migrations to auto-run.

App Service failing due to connection string not found
â†’ Added connection string under Configuration â†’ Connection Strings (not App Settings).

3ï¸âƒ£ Azure App Service (Backend Deployment)
âœ“ Actions Performed

Created App Service with .NET 8 runtime.

Connected GitHub repo.

App Service deployment succeeded.

Added:

ASPNETCORE_ENVIRONMENT=Production

Connection string (Database)

ğŸ”§ Roadblocks

HTTP 500 on app load
Cause: API could not connect to Azure SQL.
Fix: Corrected connection string in App Service settings.

CORS blocking calls from Angular
Cause: App Service CORS allowed only *.
Fix: Added Static Web App domain explicitly.

4ï¸âƒ£ Azure Static Web Apps (Frontend Deployment)
âœ“ Actions Performed

Created Azure Static Web App.

Connected GitHub repo.

Basic YAML generated.

ğŸ”§ Major Multi-Day Roadblocks
ğŸš¨ R1: Oryx forcing Node 18 â†’ Angular 20 build fails

Error:

Node.js version v18.20.8 detected. Angular CLI requires Node v20+


Caused by Azure using its own build system.

âœ” Fix:

Overrode build in GitHub Actions:

Installed Node 20 manually

Ran npm install + npm run build manually

Added skip_app_build: true

ğŸš¨ R2: Azure could not find index.html

Error:

Failed to find default file in app artifacts folder

Root Cause:

Angular 20 dist =

web/dist/web/browser/index.html


but SWA looked at:

web/

âœ” Fix:

Set:

app_location: "/"
app_artifact_location: "web/dist/web/browser"

ğŸš¨ R3: Static Web App token mismatch

When recreating SWA, old token â†’ pipeline fails.

âœ” Fix: Added new token to GitHub secrets and updated YAML.

ğŸš¨ R4: Dist folder missing in GitHub workspace

YAML was building Angular but the path expected by SWA was wrong.

âœ” Fix:
Ensured:

working-directory: ./web
npm run build


and dist was generated in correct place.

ğŸš¨ R5: GitHub Actions ignoring our artifact path

At one stage, Azure ignored app_artifact_location.

âœ” Fix:
Cleaned YAML completely and wrote a minimal version:

- uses: Azure/static-web-apps-deploy@v1
  with:
    app_location: "/"
    skip_app_build: true
    app_artifact_location: "web/dist/web/browser"


This was the winning configuration.

ğŸš¨ R6: Angular environment still pointing to localhost

UI loaded on Azure but calls API on localhost.

âœ” Fix:
Changed environment.ts â†’ production.apiUrl = App Service URL.

Rebuilt & redeployed.

ğŸš¨ R7: App Service CORS mismatch

SWA domain was not allowed â†’ 403.

âœ” Fix:
Under App Service â†’ CORS:

Added SWA URL

Disabled * wildcard for production safety.

5ï¸âƒ£ Current Status (Before Level 5)
âœ” Angular hosted on Azure Static Web App
âœ” API hosted on Azure App Service
âœ” Azure SQL DB connected & working
âœ” End-to-end cloud flow working
âœ” GitHub Actions CI/CD stable

We now have a production-like 3-tier Azure deployment.

6ï¸âƒ£ You Learned (So Far)

How Oryx works and how to bypass it

Advanced SWA artifact path debugging

Fixing Node version issues in CI/CD

Azure SQL firewall + connection strings

App Service CORS management

Environment-based API routing

Full GitHub Actions build pipeline design