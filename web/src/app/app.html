<div class="container">

  <h2>TinyTickets üéüÔ∏è</h2>

  <!-- ---------------------------------------
       CREATE TICKET
  ---------------------------------------- -->
  <section class="card">
    <h3>Create Ticket</h3>
    <form (submit)="$event.preventDefault(); create()" class="ticket-form">
      <input placeholder="Title" [(ngModel)]="title" name="title" required />
      <button type="submit">Add</button>
    </form>
  </section>

  <!-- ---------------------------------------
       TICKET LIST
  ---------------------------------------- -->
  <section class="card">
    <h3>Tickets</h3>

    <ul *ngIf="tickets.length > 0; else noTickets">
      <li *ngFor="let t of tickets" class="ticket-item">
        <span>#{{t.id}} ‚Äì {{t.title}}</span>
        <button (click)="publish(t.id)" class="publish-btn">Publish</button>
      </li>
    </ul>

    <ng-template #noTickets>
      <p class="empty">No tickets created yet.</p>
    </ng-template>
  </section>

  <!-- ---------------------------------------
       FILE UPLOAD
  ---------------------------------------- -->
  <section class="card">
    <h3>Upload Attachment</h3>
    <input type="file" (change)="onFileSelected($event)" />
  </section>

  <!-- ---------------------------------------
       FILE LIST
  ---------------------------------------- -->
  <section class="card">
    <h3>Uploaded Files</h3>

    <div *ngIf="files.length > 0; else noFiles">
      <div *ngFor="let f of files" class="file-card">
        <p><strong>{{ f.fileName }}</strong></p>
        <p class="timestamp">{{ f.uploadedOn | date:'medium' }}</p>

        <!-- Image preview -->
        <img *ngIf="f.contentType.startsWith('image')" 
             [src]="f.url"
             class="preview-img"/>

        <a [href]="f.url" download class="download-link">Download</a>
        <button class="delete-btn" (click)="delete(f.id)">Delete</button>
      </div>
    </div>

    <ng-template #noFiles>
      <p class="empty">No files uploaded yet.</p>
    </ng-template>

    <button class="download-btn" (click)="downloadReport()">
      Download PDF Report
    </button>
  </section>


  <!-- ---------------------------------------
       STYLES
  ---------------------------------------- -->
  <style>
    .container {
      padding: 2rem;
      max-width: 700px;
      margin: auto;
      font-family: Arial, sans-serif;
    }

    h3 {
      margin-top: 0;
    }

    .card {
      background: #fafafa;
      padding: 1.2rem;
      border-radius: 10px;
      border: 1px solid #ddd;
      margin-bottom: 1.5rem;
    }

    .ticket-form {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .ticket-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .publish-btn {
      background: #0078d4;
      color: white;
      border: none;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
    }

    .publish-btn:hover {
      background: #005ea1;
    }

    .empty {
      color: #777;
      font-style: italic;
    }

    .file-card {
      border: 1px solid #ddd;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 15px;
      background: white;
    }

    .preview-img {
      width: 200px;
      border-radius: 8px;
      display: block;
      margin-bottom: 10px;
    }

    .timestamp {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 6px;
    }

    .download-link {
      color: #0078d4;
      text-decoration: none;
      font-weight: 600;
    }

    .download-link:hover {
      text-decoration: underline;
    }
    .delete-btn {
      background: #d9534f;
      color: white;
      border: none;
      padding: 10px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .delete-btn:hover {
      background: #b52b27;
    }
    .download-btn {
      background: #0078d4;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 10px;
    }
  </style>
</div>
