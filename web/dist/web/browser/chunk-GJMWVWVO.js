import{Aa as m,Ba as i,Ca as n,Da as T,Ga as h,Ha as f,Ja as _,Ka as k,La as l,M as w,Ma as C,Na as S,Oa as E,Pa as M,Qa as O,R as p,Ra as P,S as d,Sa as V,Ta as v,cb as H,db as N,eb as U,fb as I,ha as x,ia as c,jb as $,mb as D,nb as B,ob as R,pa as y,pb as z,qb as A,rb as j,sb as L,ta as F,tb as W,va as g,wb as q}from"./chunk-ELG2XQJ7.js";import{f as b}from"./chunk-42NE2CY3.js";var G={production:!1,apiUrl:"https://tinytickets-api-hbh5h6etb4hvfjgw.centralindia-01.azurewebsites.net"};function K(o,t){if(o&1){let e=h();i(0,"li",13)(1,"span"),l(2),n(),i(3,"button",14),f("click",function(){let s=p(e).$implicit,a=_(2);return d(a.publish(s.id))}),l(4,"Publish"),n()()}if(o&2){let e=t.$implicit;c(2),S("#",e.id," \u2013 ",e.title)}}function Q(o,t){if(o&1&&(i(0,"ul"),g(1,K,5,2,"li",12),n()),o&2){let e=_();c(),m("ngForOf",e.tickets)}}function X(o,t){o&1&&(i(0,"p",15),l(1,"No tickets created yet."),n())}function Y(o,t){if(o&1&&T(0,"img",22),o&2){let e=_().$implicit;m("src",e.url,x)}}function Z(o,t){if(o&1){let e=h();i(0,"div",17)(1,"p")(2,"strong"),l(3),n()(),i(4,"p",18),l(5),P(6,"date"),n(),g(7,Y,1,1,"img",19),i(8,"a",20),l(9,"Download"),n(),i(10,"button",21),f("click",function(){let s=p(e).$implicit,a=_(2);return d(a.delete(s.id))}),l(11,"Delete"),n()()}if(o&2){let e=t.$implicit;c(3),C(e.fileName),c(2),C(V(6,4,e.uploadedOn,"medium")),c(2),m("ngIf",e.contentType.startsWith("image")),c(),m("href",e.url,x)}}function ee(o,t){if(o&1&&(i(0,"div"),g(1,Z,12,7,"div",16),n()),o&2){let e=_();c(),m("ngForOf",e.files)}}function te(o,t){o&1&&(i(0,"p",15),l(1,"No files uploaded yet."),n())}var J=class o{constructor(t){this.auth=t}http=w($);apiBase=G.apiUrl;tickets=[];files=[];title="";selectedFile=null;ngOnInit(){this.loadTickets(),this.loadFiles()}loadTickets(){this.http.get(`${this.apiBase}/tickets`).subscribe(t=>this.tickets=t)}create(){this.title.trim()&&this.http.post(`${this.apiBase}/tickets`,{title:this.title}).subscribe(()=>{this.title="",this.loadTickets()})}publish(t){this.http.post(`${this.apiBase}/tickets/${t}/publish`,{}).subscribe(()=>console.log(`Event published for ticket #${t}`))}onFileSelected(t){let e=t.target.files?.[0];e&&(this.selectedFile=e,this.uploadFile())}uploadFile(){return b(this,null,function*(){if(!this.selectedFile)return;let e=`${crypto.randomUUID()}_${this.selectedFile.name}`,r="ticket-images";this.http.post(`${this.apiBase}/storage/sas-upload`,{container:r,fileName:e}).subscribe(s=>b(this,null,function*(){yield fetch(s.uploadUrl,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob"},body:this.selectedFile});let a={fileName:this.selectedFile.name,blobName:e,contentType:this.selectedFile.type,size:this.selectedFile.size,container:r};this.http.post(`${this.apiBase}/storage/save-metadata`,a).subscribe(()=>this.loadFiles())}))})}loadFiles(){this.http.get(`${this.apiBase}/storage/files`).subscribe(t=>this.files=t)}delete(t){confirm("Delete this file permanently?")&&this.http.delete(`${this.apiBase}/storage/files/${t}`).subscribe(()=>{this.files=this.files.filter(e=>e.id!==t)})}downloadReport(){this.http.get(`${this.apiBase}/storage/files/report/pdf`,{responseType:"blob"}).subscribe(t=>{let e=URL.createObjectURL(t),r=document.createElement("a");r.href=e,r.download="TinyTickets_File_Report.pdf",r.click(),URL.revokeObjectURL(e)})}logout(){this.auth.logout()}static \u0275fac=function(e){return new(e||o)(y(q))};static \u0275cmp=F({type:o,selectors:[["app-home"]],decls:33,vars:5,consts:[["noTickets",""],["noFiles",""],[1,"container"],[1,"header"],[1,"logout-btn",3,"click"],[1,"card"],[1,"ticket-form",3,"submit"],["placeholder","Title","name","title","required","",3,"ngModelChange","ngModel"],["type","submit"],[4,"ngIf","ngIfElse"],["type","file",3,"change"],[1,"download-btn",3,"click"],["class","ticket-item",4,"ngFor","ngForOf"],[1,"ticket-item"],[1,"publish-btn",3,"click"],[1,"empty"],["class","file-card",4,"ngFor","ngForOf"],[1,"file-card"],[1,"timestamp"],["class","preview-img",3,"src",4,"ngIf"],["download","",1,"download-link",3,"href"],[1,"delete-btn",3,"click"],[1,"preview-img",3,"src"]],template:function(e,r){if(e&1){let s=h();i(0,"div",2)(1,"div",3)(2,"span"),l(3,"Signed in"),n(),i(4,"button",4),f("click",function(){return p(s),d(r.logout())}),l(5,"Logout"),n()(),i(6,"h2"),l(7,"TinyTickets \u{1F39F}\uFE0F"),n(),i(8,"section",5)(9,"h3"),l(10,"Create Ticket"),n(),i(11,"form",6),f("submit",function(u){return p(s),u.preventDefault(),d(r.create())}),i(12,"input",7),O("ngModelChange",function(u){return p(s),M(r.title,u)||(r.title=u),d(u)}),n(),i(13,"button",8),l(14,"Add"),n()()(),i(15,"section",5)(16,"h3"),l(17,"Tickets"),n(),g(18,Q,2,1,"ul",9)(19,X,2,0,"ng-template",null,0,v),n(),i(21,"section",5)(22,"h3"),l(23,"Upload Attachment"),n(),i(24,"input",10),f("change",function(u){return p(s),d(r.onFileSelected(u))}),n()(),i(25,"section",5)(26,"h3"),l(27,"Uploaded Files"),n(),g(28,ee,2,1,"div",9)(29,te,2,0,"ng-template",null,1,v),i(31,"button",11),f("click",function(){return p(s),d(r.downloadReport())}),l(32," Download PDF Report "),n()()()}if(e&2){let s=k(20),a=k(30);c(12),E("ngModel",r.title),c(6),m("ngIf",r.tickets.length>0)("ngIfElse",s),c(10),m("ngIf",r.files.length>0)("ngIfElse",a)}},dependencies:[I,H,N,W,j,D,B,R,L,A,z,U],styles:[".container[_ngcontent-%COMP%]{padding:2rem;max-width:700px;margin:auto;font-family:Arial,sans-serif}h3[_ngcontent-%COMP%]{margin-top:0}.card[_ngcontent-%COMP%]{background:#fafafa;padding:1.2rem;border-radius:10px;border:1px solid #ddd;margin-bottom:1.5rem}.ticket-form[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}.ticket-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee}.publish-btn[_ngcontent-%COMP%]{background:#0078d4;color:#fff;border:none;padding:4px 10px;border-radius:4px;cursor:pointer}.publish-btn[_ngcontent-%COMP%]:hover{background:#005ea1}.empty[_ngcontent-%COMP%]{color:#777;font-style:italic}.file-card[_ngcontent-%COMP%]{border:1px solid #ddd;padding:12px;border-radius:8px;margin-bottom:15px;background:#fff}.preview-img[_ngcontent-%COMP%]{width:200px;border-radius:8px;display:block;margin-bottom:10px}.timestamp[_ngcontent-%COMP%]{font-size:.85em;color:#666;margin-bottom:6px}.download-link[_ngcontent-%COMP%]{color:#0078d4;text-decoration:none;font-weight:600}.download-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.delete-btn[_ngcontent-%COMP%]{background:#d9534f;color:#fff;border:none;padding:10px;border-radius:4px;cursor:pointer}.delete-btn[_ngcontent-%COMP%]:hover{background:#b52b27}.download-btn[_ngcontent-%COMP%]{background:#0078d4;color:#fff;border:none;padding:6px 12px;border-radius:5px;cursor:pointer;margin-bottom:10px}"]})};export{J as HomeComponent};
